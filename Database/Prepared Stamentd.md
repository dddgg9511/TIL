# DB prepared Statement

> 이미 쿼리실행계획 분석과 컴파일이 완료되어서 DBMS의 캐시에 준비되어있는 쿼리를 사용한다는 의미
> 

![sql](https://user-images.githubusercontent.com/39615281/179339180-b79e9acc-ba61-49ea-824d-69c5e9d3d62f.png)

### DBMS가 쿼리를 실행하는 절차

1. Parsing (Query의 문법적, 의미적 오류 체크, 재사용 가능 SQL 확인, 쿼리실행계획 수립 등)
2. Execution (쿼리를 실행한다.)
3. Fetch(실행된 값을 가져오는 절차이므로 Select 만 해당됨. 반환하는 값이 없는 Insert, Update, Delete는 미해당.)

## prepared Statament

### 장점

- 1번 처리 구간을 건너 뛰고 2번부터 실행하기 때문에 sql 처리속도가 빠르다. (Soft Parsing)
- 1번 구간은 SQL을 분석하는 처리도 하고 있지만, 건너뛰기 때문에 대입된 값은 SQL로 인식하지 않는다. 즉 SQL Injection을 예방할 수 있다.

### 단점

- 쿼리에 오류가 생긴경우 분석하기 어렵다.
    - 바인드변수 부분이 '?'로 나오므로 실제 실행된 쿼리를 확인하는것이 어렵다.
- 바인드변수는 일부 허용된 위치에서만 사용할 수 있기 때문에 동적 쿼리 작성이 힘들다.

## Staments

### 장점

- 테이블, 컬럼에 대한 동적 쿼리 작성이 가능하다.
- 쿼리실행문을 직접 확인 가능하므로 쿼리 분석이 쉽다.

### 단점

- 1번 처리구간을 매 요청마다 수행하므로 Query 처리비용이 더 들게된다.즉 캐시 활용을 하지 못한다는 얘기이다.
- 위와는 반대로 SQL Injection으로 인한 공격에 노출된다.예를 들자면 비밀번호를 확인하는 Where 구문의 변수 부분에 '1234 OR 1 = 1' 같은 구문을 끼워넣을 경우 항상 참이 되어버리므로 악용이 가능하다.
